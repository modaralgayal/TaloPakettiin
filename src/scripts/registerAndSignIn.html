<script>
  document.addEventListener("DOMContentLoaded", function () {
    const registerForm = document.querySelector(
      "#eael-register-form.eael-register-form.eael-lr-form"
    );
    const signInForm = document.querySelector("#eael-login-form.eael-lr-form");

    console.log("Take 3");

    async function handleFormSubmission(event, formType) {
      event.preventDefault();

      console.log("This is the form type: ", formType);

      let formData;
      if (formType === "register") {
        const username = document.querySelector(
          'input[name="user_name"]'
        ).value;
        const email = document.querySelector('input[name="email"]').value;
        const password = document.querySelector('input[name="password"]').value;

        console.log("Registering user:", { username, email });

        formData = {
          username: username,
          email: email,
          password: password,
        };

        const endpoint =
          "https://3999-2001-14bb-69f-9089-7ed0-b30d-2237-bfbe.ngrok-free.app/user/signup";

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (response.ok) {
            alert("Signup successful!");
          } else {
            alert("Error: " + result.error); // Adjusted to access the error message
          }
        } catch (error) {
          console.error("Error during signup:", error);
          alert("There was an error submitting the form.");
        }
      } else if (formType === "signin") {
        const username = document.querySelector(
          'input[name="eael-user-login"]'
        ).value;
        const password = document.querySelector(
          'input[name="eael-user-password"]'
        ).value;

        console.log("Signing in user:", { username });

        formData = {
          username: username,
          password: password,
        };

        const endpoint =
          "https://3999-2001-14bb-69f-9089-7ed0-b30d-2237-bfbe.ngrok-free.app/user/signin";

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (response.ok) {
            alert("Sign-in successful!");
            localStorage.setItem("jwtToken", result.jwtToken); // Store JWT Token
            console.log("This is the jwtToken: ", result.jwtToken);
          } else {
            alert("Error: " + result.error);
          }
        } catch (error) {
          console.error("Error during sign-in:", error);
          alert("There was an error submitting the form.");
        }
      }
    }

    // Add event listeners for both forms
    if (registerForm) {
      registerForm.addEventListener("submit", function (event) {
        handleFormSubmission(event, "register");
      });
    }

    if (signInForm) {
      signInForm.addEventListener("submit", function (event) {
        handleFormSubmission(event, "signin");
      });
    }
  });
</script>
